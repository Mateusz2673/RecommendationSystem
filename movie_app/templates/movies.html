{% extends 'base.html' %}

{% block title %}
Movies
{% endblock %}

{% block content %}
<h1>Movies Page</h1>
<p>Movies table joined</p>



<!-- Formularz filtrowania -->
<form method="GET" action="{% url 'movie_app:movies_list' %}">
    <div>
        <label for="genre">Gatunek:</label>
        <select name="genre" id="genre">
            <option value="">Wybierz gatunek</option> <!-- Opcja domyślna -->
            {% for genre in genres %}
                <option value="{{ genre.display_name }}" {% if request.GET.genre == genre.display_name %}selected{% endif %}>
                    {{ genre.display_name }}
                </option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="production_year">Rok produkcji:</label>
        <input type="number" name="production_year" id="production_year" value="{{ request.GET.production_year }}">
    </div>
    <div>
        <label for="cast">Obsada:</label>
        <input type="text" name="cast" id="cast" value="{{ request.GET.cast }}">
    </div>
    <button type="submit">Filtruj</button> <!-- Przycisk do filtrowania -->
</form>


<!-- Formularz sortowania -->
<form method="GET" action="{% url 'movie_app:movies_list' %}">
    <div>
        <label for="sort_by">Sortuj według:</label>
        <select name="sort_by" id="sort_by">
            <option value="rating_asc" {% if request.GET.sort_by == 'rating_asc' %}selected{% endif %}>Ocena rosnąco</option>
            <option value="rating_desc" {% if request.GET.sort_by == 'rating_desc' %}selected{% endif %}>Ocena malejąco</option>
            <option value="votes_asc" {% if request.GET.sort_by == 'votes_asc' %}selected{% endif %}>Liczba głosów rosnąco</option>
            <option value="votes_desc" {% if request.GET.sort_by == 'votes_desc' %}selected{% endif %}>Liczba głosów malejąco</option>
        </select>
    </div>
    <button type="submit">Sortuj</button> <!-- Przycisk do sortowania -->
</form>


<h3>Movies</h3>

<div class="movie-card-container">
    {% for movie_details in movies_details %}
    <div class="movie-card">
        <div class="movie-card-header">
            <img src="{{ movie_details.movie.photo_url }}" class="poster" alt="{{ movie_details.movie.title }} poster">
        </div>
        <div class="movie-card-body">
            <h4>
                {% if movie_details.movie.movie_id %}
                    <a href="{% url 'movie_app:movie_details' movie_id=movie_details.movie.movie_id %}">
                        {{ movie_details.movie.title }}
                    </a>
                {% else %}
                    {{ movie_details.movie.title }}  <!-- Jeśli movie_id nie jest dostępny -->
                {% endif %}
            </h4>
            <p><strong>Year:</strong> {{ movie_details.movie.production_year }}</p>
            <p><strong>Rating:</strong> {{ movie_details.movie.rating }}</p>
            <p><strong>Votes:</strong> {{ movie_details.movie.votes }}</p>
            <p><strong>Genres:</strong>
                {% for genre in movie_details.genres %}
                    {{ genre.display_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p><strong>Directors:</strong>
                {% for director in movie_details.directors %}
                    {{ director.display_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p><strong>Cast:</strong>
                {% for cast in movie_details.casts %}
                    {{ cast.display_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}